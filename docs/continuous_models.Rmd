---
title: "Continuous Models"
author: "Chuck Lanfear"
date: "Updated `r stringr::str_replace(format(Sys.time(), '%I:%M %p, %B %d, %Y'), '^0','')`"
output: html_document
---

<style>
.column-left{
  float: left;
  width: 48%;
  text-align: left;
}
.column-right{
  float: right;
  width: 48%;
  text-align: left;
}
.column-center{
  float: right;
  width: 100%;
  text-align: left;
}
</style>

<div class="column-center">
## Linear Models

Modeling commands are very similar between R and Stata. The primary difference is that R argument go inside paranthesis rather than just after the name of the command as in Stata. Stata options come after a comma and are separate from formulae, but all R arguments--including formulae--are treated the same and separated by commas. Default R output is simpler than Stata: use `summary()` if you want Stata-like output. In Stata, you save model output using `estimates store` while in R you just assign the model object to a name. Note we specified which data we are using in R: R can have many data sets loaded at the same time!
</div>

<div class="column-left">
#### Stata

```
glm y x z, ///
   family(gaussian) link(identity)
estimates store example_model
```
Note in the above examples, a single Stata command can be spread over multiple lines using `///`.
</div>

<div class="column-right">
#### R

```
example_model <- 
  glm(y ~ x + z,
      family = gaussian(link = "identity"),
      data = example_data)
summary(example_model)
```
 In R, all commands can span multiple lines so long as each line (other than the last) ends in an operator (e.g. `,` as above, but also `+` like in `ggplot2` calls).
</div>

<div class="column-center">
## Difference in Difference Models
If we assume `x` is a treatment and `time` is a dummy indicating before and after, the linear model diff-in-diff estimators look as follows. These would be identical using GLM instead.
</div>

<div class="column-left">
#### Stata

```
gen x_time = x*time
regress y x time x_time
```
</div>

<div class="column-right">
#### R

```
example_did <- lm(y ~ x + time + x*time,
                   data = example_data)
summary(example_did)
```
</div>

<div class="column-center">
## Fixed Effects Models
</div>

<div class="column-left">
#### Stata

In Stata, you can set your fixed effects IDs first using `xtset` then when you run a regression on the data, use the `fe` option.
```
xtset id
xtreg y x z, fe 
```
</div>

<div class="column-right">
#### R

You can run fixed effects using dummies for each unit. If `id` is a factor, it will create K-1 dummies in your regression, leading to a fixed effects model.

```
lm(y ~ x + z + id, data = your_data)
```

You can also run fixed effects using the `lfe` package. Here `id` comes after `|`. Everything after the first `|` is treated as a fixed effect indicator. Additional bars can be added to specify intstrumental variables and clustered standard errors.

```
library(lfe)
felm(y ~ x + z | id, data = example_data)
```
</div>

<div class="column-center">
## Random Effects Models
</div>

<div class="column-left">
#### Stata

In Stata, random effects models use the same base syntax as fixed effects, except with an `re` option.
```
xtset id
xtreg y x z, re 
```
</div>

<div class="column-right">
#### R

In R, random effects models are usually conducted using the `lme4` package. The formula has two parts: the main formula (`y ~ x + z`) and the random effects (`(1|id)`).

```
library(lme4)
lmer(y ~ x + z + (1|id), data = example_data)
```

The number `1` in front of `id` here represents a *constant*. If you take a more advanced course on hierarchical models, youll learn about having *random slopes* which you can fit by replacing that `1` with variables.
</div>